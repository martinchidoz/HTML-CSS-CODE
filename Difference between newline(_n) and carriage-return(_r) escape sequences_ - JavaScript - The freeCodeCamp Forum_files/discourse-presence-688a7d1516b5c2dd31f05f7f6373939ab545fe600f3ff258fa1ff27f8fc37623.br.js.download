define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","@ember/component","@ember/template-factory","discourse-common/utils/decorators","@ember/object/computed","@ember/service"],(function(e,s,n,r,t,i){"use strict"
var l,o,a,c,p,u,d,h,m,b
function v(e,s,n,r,t){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,s,n)||n}),i),t&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(t):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,s,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const y=(0,n.createTemplateFactory)({id:"AJt5CgYz",block:'[[[41,[30,0,["shouldDisplay"]],[[[1,"  "],[10,0],[14,0,"presence-users"],[12],[1,"\\n    "],[10,0],[14,0,"presence-avatars"],[12],[1,"\\n"],[42,[28,[37,2],[[28,[37,2],[[30,0,["presenceUsers"]]],null]],null],null,[[[1,"        "],[1,[28,[35,3],[[30,1]],[["imageSize"],["small"]]]],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n    "],[10,1],[14,0,"presence-text"],[12],[1,"\\n      "],[10,1],[14,0,"description"],[12],[1,"\\n"],[41,[30,0,["isReply"]],[[[1,[28,[35,4],["presence.replying"],[["count"],[[30,0,["presenceUsers","length"]]]]]]],[]],[[[1,[28,[35,4],["presence.editing"],[["count"],[[30,0,["presenceUsers","length"]]]]]]],[]]],[1,""],[13],[1,""],[10,1],[14,0,"wave"],[12],[1,""],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[1,""],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","each","-track-array","avatar","i18n"]]',moduleName:"discourse/plugins/discourse-presence/discourse/components/composer-presence-display.hbs",isStrictMode:!1})
var f=(0,s.setComponentTemplate)(y,s.default.extend((l=(0,r.default)("model.replyingToTopic","model.editingPost","model.whisper","model.composerOpened"),o=(0,r.default)("model.topic.id","isReply","isWhisper"),a=(0,r.default)("model.topic.id","isReply","isWhisper"),c=(0,r.default)("isEdit","model.post.id"),p=(0,r.observes)("replyChannelName","whisperChannelName","editChannelName"),u=(0,r.default)("isReply","replyingUsers.[]","editingUsers.[]"),d=(0,r.on)("didInsertElement"),h=(0,r.observes)("model.reply","state","model.post.id","model.topic.id"),m=(0,r.on)("willDestroyElement"),v(b={tagName:"",presence:(0,i.inject)(),composerPresenceManager:(0,i.inject)(),state(e,s,n,r){if(r)return s?"edit":n?"whisper":e?"reply":void 0},isReply:(0,t.equal)("state","reply"),isEdit:(0,t.equal)("state","edit"),isWhisper:(0,t.equal)("state","whisper"),replyChannelName(e,s,n){if(e&&(s||n))return"/discourse-presence/reply/".concat(e)},whisperChannelName(e,s,n){if(e&&this.currentUser.whisperer&&(s||n))return"/discourse-presence/whisper/".concat(e)},editChannelName(e,s){if(e)return"/discourse-presence/edit/".concat(s)},_setupChannel(e,s){var n,r;(null===(n=this[e])||void 0===n?void 0:n.name)!==s&&(null===(r=this[e])||void 0===r||r.unsubscribe(),s?(this.set(e,this.presence.getChannel(s)),this[e].subscribe()):this[e]&&this.set(e,null))},_setupChannels(){this._setupChannel("replyChannel",this.replyChannelName),this._setupChannel("whisperChannel",this.whisperChannelName),this._setupChannel("editChannel",this.editChannelName)},_cleanupChannels(){this._setupChannel("replyChannel",null),this._setupChannel("whisperChannel",null),this._setupChannel("editChannel",null)},replyingUsers:(0,t.union)("replyChannel.users","whisperChannel.users"),editingUsers:(0,t.readOnly)("editChannel.users"),presenceUsers(e,s,n){var r
const t=e?s:n
return null==t||null===(r=t.filter((e=>e.id!==this.currentUser.id)))||void 0===r?void 0:r.slice(0,this.siteSettings.presence_max_users_shown)},shouldDisplay:(0,t.gt)("presenceUsers.length",0),subscribe(){this._setupChannels()},_contentChanged(){var e,s
if(""===this.model.reply)return
const n="edit"===this.state?null===(e=this.model)||void 0===e?void 0:e.post:null===(s=this.model)||void 0===s?void 0:s.topic
this.composerPresenceManager.notifyState(this.state,null==n?void 0:n.id)},closeComposer(){this._cleanupChannels(),this.composerPresenceManager.leave()}},"state",[l],Object.getOwnPropertyDescriptor(b,"state"),b),v(b,"replyChannelName",[o],Object.getOwnPropertyDescriptor(b,"replyChannelName"),b),v(b,"whisperChannelName",[a],Object.getOwnPropertyDescriptor(b,"whisperChannelName"),b),v(b,"editChannelName",[c],Object.getOwnPropertyDescriptor(b,"editChannelName"),b),v(b,"_setupChannels",[p],Object.getOwnPropertyDescriptor(b,"_setupChannels"),b),v(b,"presenceUsers",[u],Object.getOwnPropertyDescriptor(b,"presenceUsers"),b),v(b,"subscribe",[d],Object.getOwnPropertyDescriptor(b,"subscribe"),b),v(b,"_contentChanged",[h],Object.getOwnPropertyDescriptor(b,"_contentChanged"),b),v(b,"closeComposer",[m],Object.getOwnPropertyDescriptor(b,"closeComposer"),b),b)))
e.default=f})),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","@ember/component","@ember/template-factory","discourse-common/utils/decorators","@ember/object/computed","@ember/service"],(function(e,s,n,r,t,i){"use strict"
var l,o,a,c,p,u
function d(e,s,n,r,t){var i={}
return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,s,n)||n}),i),t&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(t):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,s,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const h=(0,n.createTemplateFactory)({id:"WxUvjwON",block:'[[[41,[30,0,["shouldDisplay"]],[[[1,"  "],[10,0],[14,0,"presence-users"],[12],[1,"\\n    "],[10,0],[14,0,"presence-avatars"],[12],[1,"\\n"],[42,[28,[37,2],[[28,[37,2],[[30,0,["users"]]],null]],null],null,[[[1,"        "],[8,[39,3],null,[["@user"],[[30,1]]],[["default"],[[[[1,"\\n          "],[1,[28,[35,4],[[30,1]],[["imageSize"],["small"]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n    "],[10,1],[14,0,"presence-text"],[12],[1,"\\n      "],[10,1],[14,0,"description"],[12],[1,[28,[35,5],["presence.replying_to_topic"],[["count"],[[30,0,["users","length"]]]]]],[13],[10,1],[14,0,"wave"],[12],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","each","-track-array","user-link","avatar","i18n"]]',moduleName:"discourse/plugins/discourse-presence/discourse/components/topic-presence-display.hbs",isStrictMode:!1})
var m=(0,s.setComponentTemplate)(h,s.default.extend((l=(0,r.default)("replyChannel.users.[]"),o=(0,r.default)("whisperChannel.users.[]"),a=(0,r.default)("topic.id"),c=(0,r.default)("topic.id"),p=(0,r.on)("willDestroyElement"),u={topic:null,presence:(0,i.inject)(),replyChannel:null,whisperChannel:null,replyUsers(e){return null==e?void 0:e.filter((e=>e.id!==this.currentUser.id))},whisperUsers(e){return null==e?void 0:e.filter((e=>e.id!==this.currentUser.id))},users:(0,t.union)("replyUsers","whisperUsers"),replyChannelName:e=>"/discourse-presence/reply/".concat(e),whisperChannelName:e=>"/discourse-presence/whisper/".concat(e),shouldDisplay:(0,t.gt)("users.length",0),didReceiveAttrs(){var e,s,n,r;(this._super(...arguments),(null===(e=this.replyChannel)||void 0===e?void 0:e.name)!==this.replyChannelName)&&(null===(n=this.replyChannel)||void 0===n||n.unsubscribe(),this.set("replyChannel",this.presence.getChannel(this.replyChannelName)),this.replyChannel.subscribe())
this.currentUser.staff&&(null===(s=this.whisperChannel)||void 0===s?void 0:s.name)!==this.whisperChannelName&&(null===(r=this.whisperChannel)||void 0===r||r.unsubscribe(),this.set("whisperChannel",this.presence.getChannel(this.whisperChannelName)),this.whisperChannel.subscribe())},_destroyed(){var e,s
null===(e=this.replyChannel)||void 0===e||e.unsubscribe(),null===(s=this.whisperChannel)||void 0===s||s.unsubscribe()}},d(u,"replyUsers",[l],Object.getOwnPropertyDescriptor(u,"replyUsers"),u),d(u,"whisperUsers",[o],Object.getOwnPropertyDescriptor(u,"whisperUsers"),u),d(u,"replyChannelName",[a],Object.getOwnPropertyDescriptor(u,"replyChannelName"),u),d(u,"whisperChannelName",[c],Object.getOwnPropertyDescriptor(u,"whisperChannelName"),u),d(u,"_destroyed",[p],Object.getOwnPropertyDescriptor(u,"_destroyed"),u),u)))
e.default=m})),define("discourse/plugins/discourse-presence/discourse/services/composer-presence-manager",["exports","@ember/service","@ember/runloop","discourse-common/config/environment"],(function(e,s,n,r){"use strict"
var t,i
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let l=(t=class extends s.default{constructor(){var e,s,n,r
super(...arguments),e=this,s="presence",r=this,(n=i)&&Object.defineProperty(e,s,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}notifyState(e,s){if(this.siteSettings.allow_users_to_hide_profile&&this.currentUser.hide_profile_and_presence)return
if(void 0===e)return this.leave()
if(!["reply","whisper","edit"].includes(e))throw"Unknown intent ".concat(e)
const t="".concat(e,"/").concat(s)
this._state!==t&&(this._enter(e,s),this._state=t),(0,r.isTesting)()||(this._autoLeaveTimer=(0,n.debounce)(this,this.leave,1e4))}leave(){var e
null===(e=this._presentChannel)||void 0===e||e.leave(),this._presentChannel=null,this._state=null,this._autoLeaveTimer&&((0,n.cancel)(this._autoLeaveTimer),this._autoLeaveTimer=null)}_enter(e,s){this.leave()
let n="".concat("/discourse-presence","/").concat(e,"/").concat(s)
this._presentChannel=this.presence.getChannel(n),this._presentChannel.enter()}willDestroy(){this.leave()}},o=t.prototype,a="presence",c=[s.inject],p={configurable:!0,enumerable:!0,writable:!0,initializer:null},d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=c.slice().reverse().reduce((function(e,s){return s(o,a,e)||e}),d),u&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(u):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(o,a,d),d=null),i=d,t)
var o,a,c,p,u,d
e.default=l})),define("discourse/plugins/discourse-presence/discourse/templates/connectors/before-composer-controls/presence",["exports","@ember/template-factory"],(function(e,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=(0,s.createTemplateFactory)({id:"AtuVqULU",block:'[[[8,[39,0],null,[["@model"],[[30,0,["model"]]]],null],[1,"\\n"]],[],false,["composer-presence-display"]]',moduleName:"discourse/plugins/discourse-presence/discourse/templates/connectors/before-composer-controls/presence.hbs",isStrictMode:!1})
e.default=n})),define("discourse/plugins/discourse-presence/discourse/templates/connectors/topic-above-footer-buttons/presence",["exports","@ember/template-factory"],(function(e,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var n=(0,s.createTemplateFactory)({id:"GNPVJV/f",block:'[[[8,[39,0],null,[["@topic"],[[30,0,["model"]]]],null],[1,"\\n"]],[],false,["topic-presence-display"]]',moduleName:"discourse/plugins/discourse-presence/discourse/templates/connectors/topic-above-footer-buttons/presence.hbs",isStrictMode:!1})
e.default=n}))

//# sourceMappingURL=discourse-presence-f27447e6e4ceea9f3dc7acf4290238f20c3ba7dc7c6aaf8a60cc772e1f5bd01b.map
//!

;
