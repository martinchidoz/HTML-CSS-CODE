define("discourse/plugins/discourse-whos-online/discourse/api-initializers/intitialize-whos-online-indicators",["exports","discourse-common/utils/decorators","@ember/service","discourse/lib/api"],(function(e,i,t,n){"use strict"
function s(e,i,t,n,s){var o={}
return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,i,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o="whos-online"
var r=(0,n.apiInitializer)("0.8",(e=>{var n,r,l,a,u,c
const d=e.container.lookup("site-settings:main"),p=d.whos_online_avatar_indicator
if("none"!==p&&(d.whos_online_display_public||(null===(n=e.getCurrentUser())||void 0===n?void 0:n.trust_level)>=d.whos_online_display_min_trust_level)){var h,b,m,f
if(document.documentElement.classList.add("whos-online-".concat(p)),e.modifyClass("component:user-card-contents",(r=(0,i.default)("user","whosOnline.users.[]"),s(l={pluginId:o,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:user-online"],isOnline(e){return e&&this.whosOnline.isUserOnline(e.id)}},"isOnline",[r],Object.getOwnPropertyDescriptor(l,"isOnline"),l),l)),e.modifyClass("route:user",(a=(0,i.default)("whosOnlineUserId","whosOnline.users.[]"),u=(0,i.observes)("isOnline"),c={pluginId:o,whosOnline:(0,t.inject)(),async afterModel(e){const i=await this._super(...arguments)
return this.set("whosOnlineUserId",e.id),this.updateBodyClass(),i},isOnline(e){return e&&this.whosOnline.isUserOnline(e)},updateBodyClass(){this.isOnline?document.body.classList.add("user-page-online"):document.body.classList.remove("user-page-online")},deactivate(){this._super(),document.body.classList.remove("user-page-online")}},s(c,"isOnline",[a],Object.getOwnPropertyDescriptor(c,"isOnline"),c),s(c,"updateBodyClass",[u],Object.getOwnPropertyDescriptor(c,"updateBodyClass"),c),c)),d.whos_online_avatar_indicator_topic_lists)e.modifyClass("component:topic-list-item",(h=(0,i.default)("topic.lastPoster.id","topic.lastPosterUser.id","whosOnline.users.[]"),s(b={pluginId:o,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:last-poster-online"],isOnline(e,i){return this.whosOnline.isUserOnline(e||i)}},"isOnline",[h],Object.getOwnPropertyDescriptor(b,"isOnline"),b),b)),e.modifyClass("component:latest-topic-list-item",(m=(0,i.default)("topic.lastPoster.id","topic.lastPosterUser.id","whosOnline.users.[]"),s(f={pluginId:o,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:last-poster-online"],isOnline(e,i){return this.whosOnline.isUserOnline(e||i)}},"isOnline",[m],Object.getOwnPropertyDescriptor(f,"isOnline"),f),f))
e.modifyClass("component:scrolling-post-stream",{pluginId:o,didInsertElement(){this._super(),this.appEvents.on("whosonline:changed",this,this._whosOnlineCallback)},willDestroyElement(){this.appEvents.off("whosonline:changed",this,this._whosOnlineCallback)},_whosOnlineCallback(e){e.forEach((e=>{this.attrs.posts.value.filter((i=>{let{user_id:t}=i
return t===e})).map((e=>e.id)).forEach((i=>{this.dirtyKeys.keyDirty("post-".concat(i)),this.dirtyKeys.keyDirty("post-".concat(i,"-avatar-").concat(e),{onRefresh:"updateOnline"})}))})),this.queueRerender()}}),e.reopenWidget("post-avatar",{buildKey:e=>"post-".concat(e.id,"-avatar-").concat(e.user_id),isUserOnline(e){return this.register.lookup("service:whos-online").isUserOnline(e)},defaultState(e){return{online:this.isUserOnline(e.user_id)}},updateOnline(){this.state.online=this.isUserOnline(this.attrs.user_id)},buildClasses:(e,i)=>i.online?"user-online":[]})}}))
e.default=r})),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online-avatar",["exports","@ember/component"],(function(e,i){"use strict"
function t(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends i.default{constructor(){super(...arguments),t(this,"tagName","a"),t(this,"attributeBindings",["user.username:data-user-card","user.path:href"])}}e.default=n})),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online",["exports","@ember/component","@ember/service","@ember/object","@ember/object/computed"],(function(e,i,t,n,s){"use strict"
var o,r,l,a,u,c,d,p,h
function b(e,i,t,n){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function m(e,i,t,n,s){var o={}
return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,i,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let f=(o=(0,s.readOnly)("whosOnline.count"),r=(0,n.computed)("whosOnline.users.[]"),l=(0,n.computed)("users","users.length"),a=(0,n.computed)("count"),u=(0,n.computed)("count"),c=(0,n.computed)("count"),d=class extends i.default{constructor(){super(...arguments),b(this,"whosOnline",p,this),b(this,"count",h,this)}get users(){var e
return null===(e=this.whosOnline.users)||void 0===e?void 0:e.slice(0,this.siteSettings.whos_online_maximum_display)}get hasUsers(){var e
return(null===(e=this.users)||void 0===e?void 0:e.length)>=this.siteSettings.whos_online_minimum_display}get hasCount(){return this.count>=this.siteSettings.whos_online_minimum_display}get isLong(){return this.count>=this.siteSettings.whos_online_collapse_threshold}get shouldDisplay(){return!(this.count<this.siteSettings.whos_online_minimum_display&&this.siteSettings.whos_online_hide_below_minimum_display)&&this.whosOnline.enabled}},p=m(d.prototype,"whosOnline",[t.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=m(d.prototype,"count",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m(d.prototype,"users",[r],Object.getOwnPropertyDescriptor(d.prototype,"users"),d.prototype),m(d.prototype,"hasUsers",[l],Object.getOwnPropertyDescriptor(d.prototype,"hasUsers"),d.prototype),m(d.prototype,"hasCount",[a],Object.getOwnPropertyDescriptor(d.prototype,"hasCount"),d.prototype),m(d.prototype,"isLong",[u],Object.getOwnPropertyDescriptor(d.prototype,"isLong"),d.prototype),m(d.prototype,"shouldDisplay",[c],Object.getOwnPropertyDescriptor(d.prototype,"shouldDisplay"),d.prototype),d)
e.default=f})),define("discourse/plugins/discourse-whos-online/discourse/services/whos-online",["exports","@ember/service","discourse/models/site","@ember/object","@ember/object/computed"],(function(e,i,t,n,s){"use strict"
var o,r,l,a,u,c,d,p,h
function b(e,i,t,n){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function m(e,i,t,n,s){var o={}
return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,i,o),o=null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let f=(o=(0,s.readOnly)("channel.users"),r=(0,s.readOnly)("channel.count"),l=(0,s.readOnly)("channel.countOnly"),a=class extends i.default{constructor(){super(...arguments),b(this,"presence",u,this),b(this,"appEvents",c,this),b(this,"users",d,this),b(this,"count",p,this),b(this,"countOnly",h,this)}init(){super.init(...arguments),this.set("channel",this.presence.getChannel("/whos-online/online")),this.enabled&&this.channel.subscribe(t.default.currentProp("whos_online_state")),this.addObserver("users.[]",this,this._usersChanged)}_usersChanged(){var e
const i=new Set((null===(e=this.users)||void 0===e?void 0:e.map((e=>e.id)))||[]),t=this._prevUserIds||new Set([]),n=[...[...i].filter((e=>!t.has(e))),...[...t].filter((e=>!i.has(e)))]
n.length>0&&this.appEvents.trigger("whosonline:changed",n)}get enabled(){var e
return!(!this.currentUser&&this.siteSettings.login_required)&&(this.siteSettings.whos_online_display_public||(null===(e=this.currentUser)||void 0===e?void 0:e.trust_level)>=this.siteSettings.whos_online_display_min_trust_level)}isUserOnline(e){var i,t
return!(null===(i=this.channel)||void 0===i||null===(t=i.users)||void 0===t||!t.findBy("id",e))}},u=m(a.prototype,"presence",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=m(a.prototype,"appEvents",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=m(a.prototype,"users",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=m(a.prototype,"count",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=m(a.prototype,"countOnly",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m(a.prototype,"enabled",[n.computed],Object.getOwnPropertyDescriptor(a.prototype,"enabled"),a.prototype),a)
e.default=f})),define("discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online-avatar",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"bPnhaDuw",block:'[[[1,[28,[35,0],[[33,1]],[["avatarTemplatePath","title","imageSize"],["avatar_template",[33,1,["username"]],"small"]]]],[1,"\\n"]],[],false,["avatar","user"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online-avatar.hbs",isStrictMode:!1})
e.default=t})),define("discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"KQ3SbGh8",block:'[[[41,[33,1],[[[1,"  "],[10,0],[14,1,"whos-online"],[15,0,[52,[33,2],"collapsed"]],[12],[1,"\\n    "],[10,1],[15,"title",[28,[37,3],["whos_online.tooltip"],[["count"],[[33,4,["whos_online_active_timeago"]]]]]],[12],[1,"\\n"],[41,[33,5],[[[1,"        "],[1,[28,[35,3],["whos_online.title"],[["count"],[[33,6]]]]],[1,"\\n"]],[]],[[[41,[33,7],[[[1,"        "],[1,[28,[35,3],["whos_online.count_only"],[["count"],[[33,6]]]]],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,3],["whos_online.no_users"],null]],[1,"\\n      "]],[]]]],[]]],[1,"    "],[13],[1,"\\n"],[41,[33,5],[[[42,[28,[37,9],[[28,[37,9],[[33,10]],null]],null],null,[[[1,"        "],[1,[28,[35,11],null,[["user"],[[30,1]]]]],[1,"\\n"]],[1]],null]],[]],null],[1,"  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","shouldDisplay","isLong","i18n","siteSettings","hasUsers","count","hasCount","each","-track-array","users","whos-online-avatar"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online.hbs",isStrictMode:!1})
e.default=t})),define("discourse/plugins/discourse-whos-online/discourse/templates/connectors/discovery-list-container-top/online_users_widget",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"oWMnmHNT",block:'[[[1,[34,0]],[1,"\\n"]],[],false,["whos-online"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/connectors/discovery-list-container-top/online_users_widget.hbs",isStrictMode:!1})
e.default=t}))

//# sourceMappingURL=discourse-whos-online-abf4ae7fd6d82ec77d05c2aaeaa2d176a7cb02f2e9501e92527cc65c01e4e1b9.map
//!

;
